@model EasyFly.Application.ViewModels.TicketDetailsViewModel

@{
    ViewData["Title"] = "Enter Ticket Details";
    var basePrice = Model.TicketPrice;
}

<h2>Enter Ticket Details</h2>

@if (ViewBag.ErrorMessage != null)
{
    <div class="alert alert-danger" role="alert">
        @ViewBag.ErrorMessage
    </div>
}

<input type="hidden" id="baseTicketPrice" value="@basePrice" />

<form asp-action="EnterTicketDetails" method="post">
    <input type="hidden" asp-for="FlightId" />
    <input type="hidden" asp-for="ReturningFlightId" />
    <input type="hidden" asp-for="RequiredSeats" />

    @for (int i = 0; i < Model.RequiredSeats; i++)
    {
        <h4>Ticket @(i + 1)</h4>
        <div class="form-group">
            <label asp-for="Tickets[i].PersonFirstName"></label>
            <input asp-for="Tickets[i].PersonFirstName" class="form-control" />
        </div>
        <div class="form-group">
            <label asp-for="Tickets[i].PersonLastName"></label>
            <input asp-for="Tickets[i].PersonLastName" class="form-control" />
        </div>
        <div class="form-group">
            <label asp-for="Tickets[i].Gender"></label>
            <select asp-for="Tickets[i].Gender" class="form-control">
                @foreach (var gender in Enum.GetValues(typeof(EasyFly.Domain.Enums.Gender)))
                {
                    <option value="@gender">@gender</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label asp-for="Tickets[i].PersonType"></label>
            <select asp-for="Tickets[i].PersonType" class="form-control">
                @foreach (var personType in Enum.GetValues(typeof(EasyFly.Domain.Enums.PersonType)))
                {
                    <option value="@personType">@personType</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label asp-for="Tickets[i].LuggageSize"></label>
            <select asp-for="Tickets[i].LuggageSize" class="form-control luggage-size" data-index="@i">
                @foreach (var size in Enum.GetValues(typeof(EasyFly.Domain.Enums.LuggageSize)))
                {
                    <option value="@size">@size</option>
                }
            </select>
        </div>
        <div class="form-group">
            <label>Ticket Price (BGN)</label>
            <span class="ticket-price" id="ticketPrice_@i">@basePrice</span>
        </div>
    }

    <button type="submit" class="btn btn-primary mt-2">Checkout</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', function () {
        var basePrice = parseFloat(document.getElementById('baseTicketPrice').value);

        function updateTicketPrice(selectElement, index) {
            var multiplier = 1;
            var selectedValue = selectElement.value;
            if (selectedValue === 'Medium') {
                multiplier = 0.8;
            } else if (selectedValue === 'Small') {
                multiplier = 0.6;
            }
            var newPrice = basePrice * multiplier;
            document.getElementById('ticketPrice_' + index).innerText = newPrice.toFixed(2);
        }

        var selects = document.querySelectorAll('.luggage-size');
        selects.forEach(function (select, index) {
            updateTicketPrice(select, index);
            select.addEventListener('change', function () {
                updateTicketPrice(select, index);
            });
        });
    });
</script>
